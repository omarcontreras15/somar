<!-- script que implementa el formulario por pasos -->
<script src="public/js/form-por-pasos.js" type="text/javascript"></script>
<!-- -->
<link href='public/css/checkbox.css' rel='stylesheet' type='text/css' />
<div class="container banner">
    <section class="title-section">
        <h1 class="title-header">
            Editar Producto </h1>
        <ul class="breadcrumb breadcrumb__t">
            <li><a href="admin.php">Inicio</a></li>
            <li class="active">Editar Producto</li>
        </ul>
    </section>
</div>
<div class='container contact'>

    <!--- bloque de alertas -->
    <div class="alert alert-success alert-white rounded" style="display: none" id="ventana-emergente-exito">
        <button type="button" data-dismiss="alert" aria-hidden="true" class="close">×</button>
        <div class="icon">
            <img src="public/images/check.png" />
        </div>
        <strong>Exito!</strong> El producto se ha actualizado exitosamente.
    </div>
    <div class="alert alert-danger alert-white rounded" style="display: none" id="ventana-emergente-error">
        <button type="button" data-dismiss="alert" aria-hidden="true" class="close">×</button>
        <div class="icon">
            <img src="public/images/cerrar.png" />
        </div>
        <strong>Error!</strong><span id="span-error"> Hubo un inconveniente al actualizar el producto, por favor intentelo de nuevo.</span>
    </div>

    <!--- bloque de alertas -->
    <hr>
    <div class="container container-fixed">
        <div class="stepwizard">
            <div class="stepwizard-row setup-panel">
                <div class="stepwizard-step">
                    <button href="#step-1" type="button" class="btn btn-primary btn-circle">1</button>
                    <p>Información Del Producto</p>
                </div>

                <div class="stepwizard-step">
                    <button href="#step-2" type="button" class="btn btn-default btn-circle">2</button>
                    <p>Asociar Categoria</p>
                </div>

                <div class="stepwizard-step">
                    <button href="#step-3" type="button" class="btn btn-default btn-circle">3</button>
                    <p>Imagenes</p>
                </div>



            </div>
        </div>
        <hr>
        <form action='admin.php' enctype='multipart/form-data' id="agregar-producto">
            <input type="hidden" name="mode" value="editar-producto">
            <input type="hidden" name="id" value="{{id_producto}}">
            <div class="row setup-content" id="step-1">
                <div class="col-xs-12">
                    <div class="col-md-12">
                        <div class="row">
                            <div class="col-md-12">
                                <fieldset class="contentStyle">
                                    <legend class="titleStyle">Editar Información Del Producto: {{id_producto}}</legend>
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-2"><label>Nombre del producto:</label></div>
                                            <div class="col-md-4"><input type="text" class="form-control" name="nombre" value="{{nombre_producto}}"></div>
                                            <div class="col-md-2"><label>Referencia del producto:</label></div>
                                            <div class="col-md-4"><input type="text" class="form-control" name="referencia" value="{{referencia}}"></div>
                                        </div>
                                        <br>
                                        <div class="row">
                                            <div class="col-md-2"><label>Precio:</label></div>
                                            <div class="col-md-4"><input type="number" name="precio" class="form-control input-number" value={{precio}}></div>
                                            <div class="col-md-3"><label>Cantidad de productos disponibles:</label></div>
                                            <div class="col-md-3"><input type="number" name="cantidad" class="form-control input-number" value={{cant_disponibles}}></div>
                                        </div>
                                        <br>
                                        <div class="row">
                                            <div class="col-md-12"><label>Descripcion:</label></div>
                                            <div class="col-md-12"><textarea rows="6" class="form-control" placeholder="Escribe la descripcion del producto"
                                                    name="descripcion">{{descripcion}}</textarea></div>

                                        </div>
                                        <br>

                                    </div>
                                </fieldset>
                                <br><br></div>
                        </div>
                        <a href="admin.php?mode=consultar-productos" class="btn btn-danger btn-lg pull-left" type="button">Cancelar &nbsp <img src="public/images/cerrar.png"></a></button>
                        <button class="btn btn-primary nextBtn btn-lg pull-right" type="button">Siguiente &rarr;</button>
                        <br>
                        <br>
                        <br>
                    </div>
                </div>
            </div>
            <!-- -->
            <div class="row setup-content" id="step-2">
                <div class="col-xs-12">
                    <div class="col-md-12">
                        <div class="row">
                            <div class="col-md-12">
                                <fieldset class="contentStyle">
                                    <legend class="titleStyle">Asociar Categorias Al Producto</legend>
                                    <div class="form-group">
                                        <div class="row">
                                            <br> {{CHECKBOX}}
                                        </div>

                                    </div>
                                </fieldset>
                                <br><br></div>
                        </div>
                        <a href="admin.php?mode=consultar-productos" class="btn btn-danger btn-lg pull-left" type="button">Cancelar &nbsp <img src="public/images/cerrar.png"></a></button>
                        <button class="btn btn-primary nextBtn btn-lg pull-right" type="button">Siguiente &rarr;</button>
                        <br>
                        <br>
                        <br>
                    </div>
                </div>
            </div>
            <!-- -->

            <div class="row setup-content" id="step-3">
                <div class="col-xs-12">
                    <div class="col-md-12">
                        <div class="row">
                            <div class="col-md-12">
                                <fieldset class="contentStyle">
                                    <legend class="titleStyle">Subir Imagenes</legend>
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-2"><label>Subir imagen 1:</label></div>
                                            <div class="col-md-8"><input type="file" class="form-control" accept="image/gif,image/jpeg,image/jpg,image/png"
                                                    name="imagen1"></div>
                                            <div id="img1" class="col-md-2"><img class="img-responsive" src="{{url_img1}}">
                                            </div>
                                        </div><br>
                                        <div class="row">
                                            <div class="col-md-2"><label>Subir imagen 2:</label></div>
                                            <div class="col-md-8"><input type="file" class="form-control" accept="image/gif,image/jpeg,image/jpg,image/png"
                                                    name="imagen2"></div>
                                            <div id="img2" class="col-md-2"><img class="img-responsive" src="{{url_img2}}">
                                            </div>
                                        </div><br>
                                        <div class="row">
                                            <div class="col-md-2"><label>Subir imagen 3:</label></div>
                                            <div class="col-md-8"><input type="file" class="form-control" accept="image/gif,image/jpeg,image/jpg,image/png"
                                                    name="imagen3"></div>
                                            <div id="img3" class="col-md-2"><img class="img-responsive" src="{{url_img3}}">
                                            </div>
                                        </div><br>

                                        <br>
                                    </div>
                                </fieldset>
                                <br><br></div>
                        </div>
                        <a href="admin.php?mode=consultar-productos" class="btn btn-danger btn-lg pull-left" type="button">Cancelar &nbsp <img src="public/images/cerrar.png"></a></button>
                        <div id="boton-submit"><label class="btn btn-primary btn-lg pull-right">Guardar &nbsp<input type="submit" style="display: none;"><img src="public/images/save.png"></label></div>
                        <br>
                        <br>
                        <br>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
</div>
<!-- FIN HTML -->
<script>
    //ESPACIO PARA COLOCAR EL CODIGO AJAX QUE ENVIE LOS ARCHIVOS
    //funcion para que se ejecute el script cuando termine de cargar
    $(document).ready(function () {

        $(".close").on("click", function () {
            $("#ventana-emergente-exito").hide();
            $("#ventana-emergente-error").hide();
        });

        cargarEventos();

        function cargarEventos() {
            //funcion para agregar el ajax al submit del formulario
            $("#agregar-producto").on("submit", function (e) {
                $("#ventana-emergente-exito").hide();
                $("#ventana-emergente-error").hide();
                //previene que se envien los datos por la url
                e.preventDefault();
                var datos = new FormData(this);
                //var con la url del archivo php
                var url = "admin.php";
                //llama a la funcion ajax
                realizarAjax(datos, url, this);
            });
        }

        //funcion ajax para enviar formulario a php
        function realizarAjax(datos, url1, form) {
            var boton = null;
            $("#ventana-emergente-error").hide();
            $.ajax({
                data: datos,
                url: url1,
                type: 'POST',
                processData: false,
                contentType: false,
                //esta funcion se ejecuta antes de enviar los datos al php
                beforeSend: function () {
                    var html = "<div id='floatingBarsG'><div class='blockG' id='rotateG_01'></div><div class='blockG' id='rotateG_02'></div><div class='blockG' id='rotateG_03'></div><div class='blockG' id='rotateG_04'></div><div class='blockG' id='rotateG_05'></div><div class='blockG' id='rotateG_06'></div><div class='blockG' id='rotateG_07'></div><div class='blockG' id='rotateG_08'></div></div>";
                    boton = $("#boton-submit").html();
                    $("#boton-submit").html(html);
                },
                //esta funncion se ejecuta cuando el php a terminado de procesar
                //con el resultado e inserta el resultado en algun elemento html
                success: function (response) {
                    console.log(response);
                    var array = JSON.parse(response);
                    if (array['resul'] >= 1) {
                        //mostramos la ventana emergente de que la carga de la evidencia fue exitosa
                        $("#ventana-emergente-exito").show();
                        $("#img1").html('<img class="img-responsive" src="' + array['url']["imagen1"] + '">');
                        $("#img2").html('<img class="img-responsive" src="' + array['url']["imagen2"] + '">');
                        $("#img3").html('<img class="img-responsive" src="' + array['url']["imagen3"] + '">');

                    } else if (response == "repetido") {
                        $("#ventana-emergente-error").show();
                        $("#span-error").text("No se puede actualizar el producto porque ya que la información ya se encuentra registrada.");
                    } else {
                        $("#ventana-emergente-error").show();
                    }
                     $("#boton-submit").html(boton);
                    window.location = "#";
                },
                error: function (xhr, status, error) {
                    $("#ventana-emergente-error").show();
                }
            });

        }

    });

</script>